<!doctype html>
<html lang="en">
  <head>
    <title>CS4241 Assignment 2</title>
    <meta charset="utf-8">
    <link type="text/css" rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <h1> Car Value Generator</h1>
    <form action="">

      <label for="carname"> Car Name: </label>
      <input type='text' id='carname' value="Car Name"> <br>

      <label for="purchaseprice"> Purchase Price: </label>
      <input type='number' id='purchaseprice' value="12000"> <br>

      <label for="purchaseyear"> Year Purchased: </label>
      <input type='number' id='purchaseyear' value='2000'> <br>

      <label for="repairs"> Number of Repairs: </label>
      <input type="number" id="repairs" value='2'> <br>

      <label for="miles"> Miles Driven: </label>
      <input type="number" id="miles" value="50000"> <br>
      <button>submit</button>
    </form>

  <table id="car_table">
    <th> Car Name</th>
    <th> Purchase Price </th>
    <th> Car Age </th>
    <th> Number of Repairs </th>
    <th> Miles Driven</th>
    <th> Estimated Value</th>
  </table>
  </body>
  <script>
  const createNewRow = function(json){

    let car_name = json.car_name;
    let purchase_price = json.purchase_price;
    let age = 2021 - json.purchase_year;
    let num_repairs = json.repairs;
    let miles_driven = json.miles;
    let estimated_value = purchase_price * (((miles_driven%10000)/10) + ((num_repairs/20)/100) + (age/100));


    // Acquire the table that we want to add to
    const tableRef = document.getElementById('car_table');

    // Construct a new Row
    let newRow = tableRef.insertRow(-1);

    // Construct and populate a new cell
    let newCar_cell = newRow.insertCell(-1);
    let newCar_text = document.createTextNode(car_name);
    newCar_cell.appendChild(newCar_text);

    let newPurchase_cell = newRow.insertCell(-1);
    let newPurchase_text = document.createTextNode('$' + purchase_price);
    newPurchase_cell.appendChild(newPurchase_text);

    let newAge_cell = newRow.insertCell(-1);
    let newAge_text = document.createTextNode(age);
    newAge_cell.appendChild(newAge_text);

    let newRepair_cell = newRow.insertCell(-1);
    let newRepair_text = document.createTextNode(num_repairs);
    newRepair_cell.appendChild(newRepair_text);

    let newMiles_cell = newRow.insertCell(-1);
    let newMiles_text = document.createTextNode(miles_driven);
    newMiles_cell.appendChild(newMiles_text);

    let newEstimate_cell = newRow.insertCell(-1);
    let newEstimate_text = document.createTextNode(estimated_value);
    newEstimate_cell.appendChild(newEstimate_text);




  }

  const submit = function( e ) {
    // prevent default form action from being carried out
    e.preventDefault()

    const car_name = document.querySelector( '#carname' );
    const purchase_price = document.querySelector('#purchaseprice');
    const purchase_year = document.querySelector('#purchaseyear');
    const repairs = document.querySelector('#repairs');
    const miles = document.querySelector('#miles');

    json = {
      car_name: car_name.value,
      purchase_price: purchase_price.value,
      purchase_year: purchase_year.value,
      repairs: repairs.value,
      miles: miles.value
    }

    body = JSON.stringify(json)

    console.log(body)


    fetch( '/submit', {
      method:'POST',
      body
    })
    .then( function( response ) {
      createNewRow(json);
      console.log( response)
    })

    return false
  }

  window.onload = function() {
    const button = document.querySelector( 'button' )
    button.onclick = submit
  }

  </script>
</html>
